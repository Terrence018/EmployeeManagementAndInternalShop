<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.empmall.mapper.PointsLogMapper">

    <insert id="insert">
        INSERT INTO points_log(emp_id, type, points, balance, info, create_time, operator_id)
        VALUES(#{empId}, #{type}, #{points}, #{balance}, #{info}, #{createTime}, #{operatorId})
    </insert>

    <select id="listAll" resultType="com.empmall.pojo.PointsLog">
        SELECT
            pl.*,
            e.name as empName
        FROM points_log pl
                 LEFT JOIN emp e ON pl.emp_id = e.id
        ORDER BY pl.create_time DESC
    </select>

    <select id="listByEmpId" resultType="com.empmall.pojo.PointsLog">
        SELECT
            pl.*,
            op.name as operatorName
        FROM points_log pl
                 LEFT JOIN emp op ON pl.operator_id = op.id
        WHERE pl.emp_id = #{empId}
        ORDER BY pl.create_time DESC
    </select>

    <select id="list" resultType="com.empmall.pojo.PointsLog">
        SELECT
        pl.*,
        e.name as empName,
        op.name as operatorName
        FROM points_log pl
        LEFT JOIN emp e ON pl.emp_id = e.id
        LEFT JOIN emp op ON pl.operator_id = op.id
        <where>
            <if test="name != null and name != ''">
                AND e.name LIKE concat('%', #{name}, '%')
            </if>
        </where>
        ORDER BY pl.create_time DESC
    </select>

</mapper>